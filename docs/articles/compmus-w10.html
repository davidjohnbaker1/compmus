<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Week 10 · Key and Chord Estimation • compmus</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Week 10 · Key and Chord Estimation">
<meta property="og:description" content="compmus">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">compmus</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9008</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/compmus-w08.html">Week 8 · Chroma Features</a>
    </li>
    <li>
      <a href="../articles/compmus-w09.html">Week 9 · Structure Analysis · Self-Similarity Matrices</a>
    </li>
    <li>
      <a href="../articles/compmus-w10.html">Week 10 · Key and Chord Estimation</a>
    </li>
    <li>
      <a href="../articles/compmus-w11.html">Week 11 · Classification</a>
    </li>
    <li>
      <a href="../articles/compmus-w12.html">Week 12 · Similarity and Clustering</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Week 10 · Key and Chord Estimation</h1>
                        <h4 data-toc-skip class="author">John Ashley
Burgoyne</h4>
            
            <h4 data-toc-skip class="date">6 March 2019</h4>
      
      
      <div class="hidden name"><code>compmus-w10.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="set-up">Set-up<a class="anchor" aria-label="anchor" href="#set-up"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ── <span style="font-weight: bold;">Attaching packages</span> ─────────────────────────────────────── tidyverse 1.3.2 ──</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">ggplot2</span> 3.4.1     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">purrr  </span> 1.0.1</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tibble </span> 3.1.8     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">dplyr  </span> 1.1.0</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tidyr  </span> 1.3.0     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">stringr</span> 1.5.0</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">readr  </span> 2.1.4     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">forcats</span> 1.0.0</span></span>
<span><span class="co">## ── <span style="font-weight: bold;">Conflicts</span> ────────────────────────────────────────── tidyverse_conflicts() ──</span></span>
<span><span class="co">## <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">filter()</span> masks <span style="color: #0000BB;">stats</span>::filter()</span></span>
<span><span class="co">## <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">lag()</span>    masks <span style="color: #0000BB;">stats</span>::lag()</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/charlie86/spotifyr" class="external-link">spotifyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">compmus</span><span class="op">)</span></span></code></pre></div>
<p>In order for the code below to run, it is also necessary to set up
Spotify login credentials for <code>spotifyr</code>.</p>
</div>
<div class="section level2">
<h2 id="tonal-templates">Tonal Templates<a class="anchor" aria-label="anchor" href="#tonal-templates"></a>
</h2>
<p>The focus of the readings this week were chord and key estimation.
One set of standard templates is below: 1–0 coding for the chord
templates and the Krumhansl–Kessler key profiles.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">circshift</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">v</span>, <span class="va">n</span><span class="op">)</span> <span class="op">{</span><span class="kw">if</span> <span class="op">(</span><span class="va">n</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="va">v</span> <span class="kw">else</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">v</span>, <span class="va">n</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">v</span>, <span class="op">-</span><span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">}</span></span>
<span>                                    </span>
<span>    <span class="co"># C     C#    D     Eb    E     F     F#    G     Ab    A     Bb    B </span></span>
<span><span class="va">major_chord</span> <span class="op">&lt;-</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,    <span class="fl">0</span>,    <span class="fl">0</span>,    <span class="fl">0</span>,    <span class="fl">1</span>,    <span class="fl">0</span>,    <span class="fl">0</span>,    <span class="fl">1</span>,    <span class="fl">0</span>,    <span class="fl">0</span>,    <span class="fl">0</span>,    <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">minor_chord</span> <span class="op">&lt;-</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,    <span class="fl">0</span>,    <span class="fl">0</span>,    <span class="fl">1</span>,    <span class="fl">0</span>,    <span class="fl">0</span>,    <span class="fl">0</span>,    <span class="fl">1</span>,    <span class="fl">0</span>,    <span class="fl">0</span>,    <span class="fl">0</span>,    <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">seventh_chord</span> <span class="op">&lt;-</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,    <span class="fl">0</span>,    <span class="fl">0</span>,    <span class="fl">0</span>,    <span class="fl">1</span>,    <span class="fl">0</span>,    <span class="fl">0</span>,    <span class="fl">1</span>,    <span class="fl">0</span>,    <span class="fl">0</span>,    <span class="fl">1</span>,    <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">major_key</span> <span class="op">&lt;-</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6.35</span>, <span class="fl">2.23</span>, <span class="fl">3.48</span>, <span class="fl">2.33</span>, <span class="fl">4.38</span>, <span class="fl">4.09</span>, <span class="fl">2.52</span>, <span class="fl">5.19</span>, <span class="fl">2.39</span>, <span class="fl">3.66</span>, <span class="fl">2.29</span>, <span class="fl">2.88</span><span class="op">)</span></span>
<span><span class="va">minor_key</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6.33</span>, <span class="fl">2.68</span>, <span class="fl">3.52</span>, <span class="fl">5.38</span>, <span class="fl">2.60</span>, <span class="fl">3.53</span>, <span class="fl">2.54</span>, <span class="fl">4.75</span>, <span class="fl">3.98</span>, <span class="fl">2.69</span>, <span class="fl">3.34</span>, <span class="fl">3.17</span><span class="op">)</span></span>
<span></span>
<span><span class="va">chord_templates</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>        <span class="op">~</span><span class="va">name</span>  , <span class="op">~</span><span class="va">template</span>,</span>
<span>        <span class="st">'Gb:7'</span>  , <span class="fu">circshift</span><span class="op">(</span><span class="va">seventh_chord</span>,  <span class="fl">6</span><span class="op">)</span>,</span>
<span>        <span class="st">'Gb:maj'</span>, <span class="fu">circshift</span><span class="op">(</span><span class="va">major_chord</span>,    <span class="fl">6</span><span class="op">)</span>,</span>
<span>        <span class="st">'Bb:min'</span>, <span class="fu">circshift</span><span class="op">(</span><span class="va">minor_chord</span>,   <span class="fl">10</span><span class="op">)</span>,</span>
<span>        <span class="st">'Db:maj'</span>, <span class="fu">circshift</span><span class="op">(</span><span class="va">major_chord</span>,    <span class="fl">1</span><span class="op">)</span>,</span>
<span>        <span class="st">'F:min'</span> , <span class="fu">circshift</span><span class="op">(</span><span class="va">minor_chord</span>,    <span class="fl">5</span><span class="op">)</span>,</span>
<span>        <span class="st">'Ab:7'</span>  , <span class="fu">circshift</span><span class="op">(</span><span class="va">seventh_chord</span>,  <span class="fl">8</span><span class="op">)</span>,</span>
<span>        <span class="st">'Ab:maj'</span>, <span class="fu">circshift</span><span class="op">(</span><span class="va">major_chord</span>,    <span class="fl">8</span><span class="op">)</span>,</span>
<span>        <span class="st">'C:min'</span> , <span class="fu">circshift</span><span class="op">(</span><span class="va">minor_chord</span>,    <span class="fl">0</span><span class="op">)</span>,</span>
<span>        <span class="st">'Eb:7'</span>  , <span class="fu">circshift</span><span class="op">(</span><span class="va">seventh_chord</span>,  <span class="fl">3</span><span class="op">)</span>,</span>
<span>        <span class="st">'Eb:maj'</span>, <span class="fu">circshift</span><span class="op">(</span><span class="va">major_chord</span>,    <span class="fl">3</span><span class="op">)</span>,</span>
<span>        <span class="st">'G:min'</span> , <span class="fu">circshift</span><span class="op">(</span><span class="va">minor_chord</span>,    <span class="fl">7</span><span class="op">)</span>,</span>
<span>        <span class="st">'Bb:7'</span>  , <span class="fu">circshift</span><span class="op">(</span><span class="va">seventh_chord</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>        <span class="st">'Bb:maj'</span>, <span class="fu">circshift</span><span class="op">(</span><span class="va">major_chord</span>,   <span class="fl">10</span><span class="op">)</span>,</span>
<span>        <span class="st">'D:min'</span> , <span class="fu">circshift</span><span class="op">(</span><span class="va">minor_chord</span>,    <span class="fl">2</span><span class="op">)</span>,</span>
<span>        <span class="st">'F:7'</span>   , <span class="fu">circshift</span><span class="op">(</span><span class="va">seventh_chord</span>,  <span class="fl">5</span><span class="op">)</span>,</span>
<span>        <span class="st">'F:maj'</span> , <span class="fu">circshift</span><span class="op">(</span><span class="va">major_chord</span>,    <span class="fl">5</span><span class="op">)</span>,</span>
<span>        <span class="st">'A:min'</span> , <span class="fu">circshift</span><span class="op">(</span><span class="va">minor_chord</span>,    <span class="fl">9</span><span class="op">)</span>,</span>
<span>        <span class="st">'C:7'</span>   , <span class="fu">circshift</span><span class="op">(</span><span class="va">seventh_chord</span>,  <span class="fl">0</span><span class="op">)</span>,</span>
<span>        <span class="st">'C:maj'</span> , <span class="fu">circshift</span><span class="op">(</span><span class="va">major_chord</span>,    <span class="fl">0</span><span class="op">)</span>,</span>
<span>        <span class="st">'E:min'</span> , <span class="fu">circshift</span><span class="op">(</span><span class="va">minor_chord</span>,    <span class="fl">4</span><span class="op">)</span>,</span>
<span>        <span class="st">'G:7'</span>   , <span class="fu">circshift</span><span class="op">(</span><span class="va">seventh_chord</span>,  <span class="fl">7</span><span class="op">)</span>,</span>
<span>        <span class="st">'G:maj'</span> , <span class="fu">circshift</span><span class="op">(</span><span class="va">major_chord</span>,    <span class="fl">7</span><span class="op">)</span>,</span>
<span>        <span class="st">'B:min'</span> , <span class="fu">circshift</span><span class="op">(</span><span class="va">minor_chord</span>,   <span class="fl">11</span><span class="op">)</span>,</span>
<span>        <span class="st">'D:7'</span>   , <span class="fu">circshift</span><span class="op">(</span><span class="va">seventh_chord</span>,  <span class="fl">2</span><span class="op">)</span>,</span>
<span>        <span class="st">'D:maj'</span> , <span class="fu">circshift</span><span class="op">(</span><span class="va">major_chord</span>,    <span class="fl">2</span><span class="op">)</span>,</span>
<span>        <span class="st">'F#:min'</span>, <span class="fu">circshift</span><span class="op">(</span><span class="va">minor_chord</span>,    <span class="fl">6</span><span class="op">)</span>,</span>
<span>        <span class="st">'A:7'</span>   , <span class="fu">circshift</span><span class="op">(</span><span class="va">seventh_chord</span>,  <span class="fl">9</span><span class="op">)</span>,</span>
<span>        <span class="st">'A:maj'</span> , <span class="fu">circshift</span><span class="op">(</span><span class="va">major_chord</span>,    <span class="fl">9</span><span class="op">)</span>,</span>
<span>        <span class="st">'C#:min'</span>, <span class="fu">circshift</span><span class="op">(</span><span class="va">minor_chord</span>,    <span class="fl">1</span><span class="op">)</span>,</span>
<span>        <span class="st">'E:7'</span>   , <span class="fu">circshift</span><span class="op">(</span><span class="va">seventh_chord</span>,  <span class="fl">4</span><span class="op">)</span>,</span>
<span>        <span class="st">'E:maj'</span> , <span class="fu">circshift</span><span class="op">(</span><span class="va">major_chord</span>,    <span class="fl">4</span><span class="op">)</span>,</span>
<span>        <span class="st">'G#:min'</span>, <span class="fu">circshift</span><span class="op">(</span><span class="va">minor_chord</span>,    <span class="fl">8</span><span class="op">)</span>,</span>
<span>        <span class="st">'B:7'</span>   , <span class="fu">circshift</span><span class="op">(</span><span class="va">seventh_chord</span>, <span class="fl">11</span><span class="op">)</span>,</span>
<span>        <span class="st">'B:maj'</span> , <span class="fu">circshift</span><span class="op">(</span><span class="va">major_chord</span>,   <span class="fl">11</span><span class="op">)</span>,</span>
<span>        <span class="st">'D#:min'</span>, <span class="fu">circshift</span><span class="op">(</span><span class="va">minor_chord</span>,    <span class="fl">3</span><span class="op">)</span>,</span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">key_templates</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>        <span class="op">~</span><span class="va">name</span>    , <span class="op">~</span><span class="va">template</span>,</span>
<span>        <span class="st">'Gb:maj'</span>, <span class="fu">circshift</span><span class="op">(</span><span class="va">major_key</span>,  <span class="fl">6</span><span class="op">)</span>,</span>
<span>        <span class="st">'Bb:min'</span>, <span class="fu">circshift</span><span class="op">(</span><span class="va">minor_key</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>        <span class="st">'Db:maj'</span>, <span class="fu">circshift</span><span class="op">(</span><span class="va">major_key</span>,  <span class="fl">1</span><span class="op">)</span>,</span>
<span>        <span class="st">'F:min'</span> , <span class="fu">circshift</span><span class="op">(</span><span class="va">minor_key</span>,  <span class="fl">5</span><span class="op">)</span>,</span>
<span>        <span class="st">'Ab:maj'</span>, <span class="fu">circshift</span><span class="op">(</span><span class="va">major_key</span>,  <span class="fl">8</span><span class="op">)</span>,</span>
<span>        <span class="st">'C:min'</span> , <span class="fu">circshift</span><span class="op">(</span><span class="va">minor_key</span>,  <span class="fl">0</span><span class="op">)</span>,</span>
<span>        <span class="st">'Eb:maj'</span>, <span class="fu">circshift</span><span class="op">(</span><span class="va">major_key</span>,  <span class="fl">3</span><span class="op">)</span>,</span>
<span>        <span class="st">'G:min'</span> , <span class="fu">circshift</span><span class="op">(</span><span class="va">minor_key</span>,  <span class="fl">7</span><span class="op">)</span>,</span>
<span>        <span class="st">'Bb:maj'</span>, <span class="fu">circshift</span><span class="op">(</span><span class="va">major_key</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>        <span class="st">'D:min'</span> , <span class="fu">circshift</span><span class="op">(</span><span class="va">minor_key</span>,  <span class="fl">2</span><span class="op">)</span>,</span>
<span>        <span class="st">'F:maj'</span> , <span class="fu">circshift</span><span class="op">(</span><span class="va">major_key</span>,  <span class="fl">5</span><span class="op">)</span>,</span>
<span>        <span class="st">'A:min'</span> , <span class="fu">circshift</span><span class="op">(</span><span class="va">minor_key</span>,  <span class="fl">9</span><span class="op">)</span>,</span>
<span>        <span class="st">'C:maj'</span> , <span class="fu">circshift</span><span class="op">(</span><span class="va">major_key</span>,  <span class="fl">0</span><span class="op">)</span>,</span>
<span>        <span class="st">'E:min'</span> , <span class="fu">circshift</span><span class="op">(</span><span class="va">minor_key</span>,  <span class="fl">4</span><span class="op">)</span>,</span>
<span>        <span class="st">'G:maj'</span> , <span class="fu">circshift</span><span class="op">(</span><span class="va">major_key</span>,  <span class="fl">7</span><span class="op">)</span>,</span>
<span>        <span class="st">'B:min'</span> , <span class="fu">circshift</span><span class="op">(</span><span class="va">minor_key</span>, <span class="fl">11</span><span class="op">)</span>,</span>
<span>        <span class="st">'D:maj'</span> , <span class="fu">circshift</span><span class="op">(</span><span class="va">major_key</span>,  <span class="fl">2</span><span class="op">)</span>,</span>
<span>        <span class="st">'F#:min'</span>, <span class="fu">circshift</span><span class="op">(</span><span class="va">minor_key</span>,  <span class="fl">6</span><span class="op">)</span>,</span>
<span>        <span class="st">'A:maj'</span> , <span class="fu">circshift</span><span class="op">(</span><span class="va">major_key</span>,  <span class="fl">9</span><span class="op">)</span>,</span>
<span>        <span class="st">'C#:min'</span>, <span class="fu">circshift</span><span class="op">(</span><span class="va">minor_key</span>,  <span class="fl">1</span><span class="op">)</span>,</span>
<span>        <span class="st">'E:maj'</span> , <span class="fu">circshift</span><span class="op">(</span><span class="va">major_key</span>,  <span class="fl">4</span><span class="op">)</span>,</span>
<span>        <span class="st">'G#:min'</span>, <span class="fu">circshift</span><span class="op">(</span><span class="va">minor_key</span>,  <span class="fl">8</span><span class="op">)</span>,</span>
<span>        <span class="st">'B:maj'</span> , <span class="fu">circshift</span><span class="op">(</span><span class="va">major_key</span>, <span class="fl">11</span><span class="op">)</span>,</span>
<span>        <span class="st">'D#:min'</span>, <span class="fu">circshift</span><span class="op">(</span><span class="va">minor_key</span>,  <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="chordograms-and-keygrams">Chordograms and Keygrams<a class="anchor" aria-label="anchor" href="#chordograms-and-keygrams"></a>
</h2>
<p>Armed with these templates, we can make chordograms and keygrams for
individual pieces. Similar to previous weeks, we start by choosing a
level of hierarchy and then summarise the chroma features a that level.
Higher levels like <code>section</code> are more appropriate for key
profiles; lower levels like <code>beat</code> are more appropriate for
chord profiles.</p>
<p>The following code fetches the analysis for Zager and Evans’s ‘In the
Year 2525’ (1969).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">twenty_five</span> <span class="op">&lt;-</span> </span>
<span>    <span class="fu"><a href="../reference/get_tidy_audio_analysis.html">get_tidy_audio_analysis</a></span><span class="op">(</span><span class="st">'5UVsbUV0Kh033cqsZ5sLQi'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="../reference/compmus_align.html">compmus_align</a></span><span class="op">(</span><span class="va">sections</span>, <span class="va">segments</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">sections</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">sections</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        pitches <span class="op">=</span> </span>
<span>            <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">segments</span>, </span>
<span>                <span class="va">compmus_summarise</span>, <span class="va">pitches</span>, </span>
<span>                method <span class="op">=</span> <span class="st">'mean'</span>, norm <span class="op">=</span> <span class="st">'manhattan'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The new helper function <code>compmus_match_pitch_template</code>
compares the averaged chroma vectors against templates to yield a
chordo- or keygram. The two truck-driver modulations from G-sharp minor
through A minor to B-flat minor are clear.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">twenty_five</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="../reference/compmus_match_pitch_template.html">compmus_match_pitch_template</a></span><span class="op">(</span><span class="va">key_templates</span>, <span class="st">'euclidean'</span>, <span class="st">'manhattan'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">start</span> <span class="op">+</span> <span class="va">duration</span> <span class="op">/</span> <span class="fl">2</span>, width <span class="op">=</span> <span class="va">duration</span>, y <span class="op">=</span> <span class="va">name</span>, fill <span class="op">=</span> <span class="va">d</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">'E'</span>, guide <span class="op">=</span> <span class="st">'none'</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Time (s)'</span>, y <span class="op">=</span> <span class="st">''</span><span class="op">)</span></span></code></pre></div>
<p><img src="compmus-w10_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>Once you have the code running, try the following adaptations.</p>
<ul>
<li>Try summarising the track at different levels of hierarchy (beats,
bars, sections), as well as different combinations of summarisation
methods and norms, just as previous weeks. The table below repeats the
combinations we have considered.</li>
<li>Try making a chordogram instead of the keygram above.</li>
<li>Replace the key profiles above with Temperley’s proposed
improvements from the reading this week. (Don’t forget to re-run the
chunk after you are finished.) Do the revised profiles work any better?
Can you think of a way to improve the chord profiles, too?</li>
</ul>
<table style="width:100%;" class="table">
<colgroup>
<col width="38%">
<col width="20%">
<col width="15%">
<col width="26%">
</colgroup>
<thead><tr class="header">
<th>Domain</th>
<th>Normalisation</th>
<th>Distance</th>
<th>Summary Statistic</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Non-negative (e.g., chroma)</td>
<td>Manhattan</td>
<td>Manhattan</td>
<td>mean</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td>Aitchison</td>
<td>Aitchison centre</td>
</tr>
<tr class="odd">
<td></td>
<td>Euclidean</td>
<td>cosine</td>
<td>root mean square</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td>angular</td>
<td>root mean square</td>
</tr>
<tr class="odd">
<td></td>
<td>Chebyshev</td>
<td>[none]</td>
<td>max</td>
</tr>
<tr class="even">
<td>Full-range (e.g., timbre)</td>
<td>[none]</td>
<td>Euclidean</td>
<td>mean</td>
</tr>
<tr class="odd">
<td></td>
<td>Euclidean</td>
<td>cosine</td>
<td>root mean square</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td>angular</td>
<td>root mean square</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="track-level-summaries">Track-Level Summaries<a class="anchor" aria-label="anchor" href="#track-level-summaries"></a>
</h2>
<p>Several students have asked how to incorporate the low-level audio
analysis features at the playlist level. Here is one strategy for doing
so, which we will extend next week. As an example, let’s consider the
difference between Spotify’s ‘Sound of’ playlists for bebop and big
band.</p>
<p>After loading the playlists, we can use the helper function
<code>add_audio_analysis</code> to fetch the low-level features for
every track. Adding audio analysis for every track is a slow operation,
and so for the purposes of this exercise, we will limit ourselves to 30
tracks from each playlist. The results makes heavy use of list-columns,
which are discussed in more detail in the optional <code>purrr</code>
exercise on DataCamp.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bebop</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/spotifyr/man/get_playlist_audio_features.html" class="external-link">get_playlist_audio_features</a></span><span class="op">(</span></span>
<span>        <span class="st">'thesoundsofspotify'</span>, </span>
<span>        <span class="st">'55s8gstHcaCyfU47mQgLrB'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="../reference/add_audio_analysis.html">add_audio_analysis</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">bigband</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/spotifyr/man/get_playlist_audio_features.html" class="external-link">get_playlist_audio_features</a></span><span class="op">(</span></span>
<span>        <span class="st">'thesoundsofspotify'</span>, </span>
<span>        <span class="st">'2cjIvuw4VVOQSeUAZfNiqY'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="../reference/add_audio_analysis.html">add_audio_analysis</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">jazz</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">bebop</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>genre <span class="op">=</span> <span class="st">"Bebop"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">bigband</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>genre <span class="op">=</span> <span class="st">"Big Band"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>For non-vector features, we can use the <code>summarise_at</code>
command to collect summary statistics like mean and standard
deviation.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">jazz</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        sections <span class="op">=</span> </span>
<span>            <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>                <span class="va">sections</span>, </span>
<span>                <span class="va">summarise_at</span>, </span>
<span>                <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">tempo</span>, <span class="va">loudness</span>, <span class="va">duration</span><span class="op">)</span>, </span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>section_mean <span class="op">=</span> <span class="va">mean</span>, section_sd <span class="op">=</span> <span class="va">sd</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">sections</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>            x <span class="op">=</span> <span class="va">tempo</span>, </span>
<span>            y <span class="op">=</span> <span class="va">tempo_section_sd</span>, </span>
<span>            colour <span class="op">=</span> <span class="va">genre</span>, </span>
<span>            alpha <span class="op">=</span> <span class="va">loudness</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>size <span class="op">=</span> <span class="va">duration</span> <span class="op">/</span> <span class="fl">60</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_rug.html" class="external-link">geom_rug</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="st">'Mean Tempo (bpm)'</span>, </span>
<span>        y <span class="op">=</span> <span class="st">'SD Tempo'</span>, </span>
<span>        colour <span class="op">=</span> <span class="st">'Genre'</span>, </span>
<span>        size <span class="op">=</span> <span class="st">'Duration (min)'</span>, </span>
<span>        alpha <span class="op">=</span> <span class="st">'Volume (dBFS)'</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Removed 13 rows containing missing values (`geom_point()`).</span></span></code></pre>
<p><img src="compmus-w10_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>When working with vector-valued features like chroma or timbre, we
need to use functions from the previous weeks. Here is an example of
comparing average timbre coefficients in bebop and big band. Coefficient
6 looks like the most promising marker distinguishing these genres, but
we should verify that with cepstrograms and listening tests of specific
pieces, supported by the Spotify documentation for its timbre
features.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">jazz</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        timbre <span class="op">=</span></span>
<span>            <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>                <span class="va">segments</span>,</span>
<span>                <span class="va">compmus_summarise</span>,</span>
<span>                <span class="va">timbre</span>,</span>
<span>                method <span class="op">=</span> <span class="st">'mean'</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">genre</span>, <span class="va">timbre</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="va">compmus_gather_timbre</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">basis</span>, y <span class="op">=</span> <span class="va">value</span>, fill <span class="op">=</span> <span class="va">genre</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html" class="external-link">geom_violin</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_d</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Spotify Timbre Coefficients'</span>, y <span class="op">=</span> <span class="st">''</span>, fill <span class="op">=</span> <span class="st">'Genre'</span><span class="op">)</span></span></code></pre></div>
<p><img src="compmus-w10_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by John Ashley Burgoyne.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
